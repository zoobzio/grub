---
title: Provider Reference
description: Provider-specific behaviors and configuration
author: zoobzio
published: 2025-01-07
updated: 2025-01-07
tags:
  - Providers
  - Reference
  - Configuration
---

# Provider Reference

Provider-specific behaviors, limitations, and configuration options.

## Key-Value Providers

### Redis

```go
import "github.com/zoobzio/grub/redis"
```

#### Constructor

```go
func New(client *redis.Client) *Provider
```

Accepts `*redis.Client`, `*redis.ClusterClient`, or any client implementing the required interface.

```go
client := goredis.NewClient(&goredis.Options{
    Addr:     "localhost:6379",
    Password: "",
    DB:       0,
})
provider := redis.New(client)
```

#### Behaviors

| Operation | Implementation |
|-----------|---------------|
| Get | GET command |
| Set | SET with EX option |
| Delete | DEL command |
| Exists | EXISTS command |
| List | SCAN with MATCH |
| GetBatch | MGET command |
| SetBatch | Pipelined SET |

#### Features

| Feature | Support |
|---------|---------|
| TTL | Full (native) |
| Batch atomicity | No (pipelined) |
| Distributed | Yes |

#### Error Mapping

| Redis Error | Grub Error |
|-------------|------------|
| `redis.Nil` | `ErrNotFound` |

#### Notes

- List uses SCAN, which is safe for production (non-blocking)
- SetBatch uses pipelining (each SET is independent)
- Cluster mode supported via `*redis.ClusterClient`

---

### BadgerDB

```go
import "github.com/zoobzio/grub/badger"
```

#### Constructor

```go
func New(db *badger.DB) *Provider
```

```go
opts := badgerdb.DefaultOptions("./data")
opts.Logger = nil
db, _ := badgerdb.Open(opts)
provider := badger.New(db)
```

#### Behaviors

| Operation | Implementation |
|-----------|---------------|
| Get | View transaction |
| Set | Update transaction with Entry |
| Delete | Update transaction |
| Exists | View transaction |
| List | Iterator with prefix |
| GetBatch | View transaction |
| SetBatch | WriteBatch |

#### Features

| Feature | Support |
|---------|---------|
| TTL | Full (Entry.WithTTL) |
| Batch atomicity | Yes (WriteBatch) |
| Embedded | Yes |
| Encryption | Yes (Badger native) |

#### Error Mapping

| Badger Error | Grub Error |
|--------------|------------|
| `badger.ErrKeyNotFound` | `ErrNotFound` |

#### Configuration Options

```go
opts := badgerdb.DefaultOptions(path)
opts.Logger = nil                    // Silence logs
opts.ValueLogFileSize = 64 << 20     // 64MB value log
opts.NumMemtables = 2                // Memory tables
opts.NumLevelZeroTables = 2          // L0 tables
```

#### In-Memory Mode

```go
opts := badgerdb.DefaultOptions("").WithInMemory(true)
```

---

### BoltDB

```go
import "github.com/zoobzio/grub/bolt"
```

#### Constructor

```go
func New(db *bbolt.DB, bucket string) *Provider
```

`bucket` is the BoltDB bucket name for data storage.

```go
db, _ := bbolt.Open("my.db", 0600, nil)
provider := bolt.New(db, "sessions")
```

#### Behaviors

| Operation | Implementation |
|-----------|---------------|
| Get | View transaction |
| Set | Update transaction |
| Delete | Update transaction |
| Exists | View transaction |
| List | Cursor iteration |
| GetBatch | View transaction |
| SetBatch | Single Update transaction |

#### Features

| Feature | Support |
|---------|---------|
| TTL | **Not supported** |
| Batch atomicity | Yes |
| Embedded | Yes |
| Multiple stores | Yes (via bucket name) |

#### Error Mapping

| Condition | Grub Error |
|-----------|------------|
| Key not in bucket | `ErrNotFound` |
| TTL > 0 | `ErrTTLNotSupported` |

#### Notes

- **TTL is not supported.** Set with ttl > 0 returns `ErrTTLNotSupported`
- Multiple stores can share one DB file using different bucket names
- Auto-creates bucket on first write

#### Multiple Buckets

```go
db, _ := bbolt.Open("app.db", 0600, nil)
sessions := grub.NewStore[Session](bolt.New(db, "sessions"))
configs := grub.NewStore[Config](bolt.New(db, "configs"))
```

---

## Blob Storage Providers

### AWS S3

```go
import "github.com/zoobzio/grub/s3"
```

#### Constructor

```go
func New(client *s3.Client, bucket string) *Provider
```

```go
cfg, _ := config.LoadDefaultConfig(ctx)
client := awss3.NewFromConfig(cfg)
provider := s3.New(client, "my-bucket")
```

#### Behaviors

| Operation | Implementation |
|-----------|---------------|
| Get | GetObject |
| Put | PutObject |
| Delete | HeadObject + DeleteObject |
| Exists | HeadObject |
| List | ListObjectsV2 |

#### Features

| Feature | Support |
|---------|---------|
| Metadata | Yes |
| ContentType | Yes |
| ETag | Yes (from response) |

#### Error Mapping

| S3 Error | Grub Error |
|----------|------------|
| `NoSuchKey` | `ErrNotFound` |

#### Notes

- Delete checks Exists first (S3 DeleteObject succeeds on missing keys)
- List uses continuation tokens for pagination
- Metadata preserved in ObjectInfo

#### Custom Endpoint (MinIO/LocalStack)

```go
cfg, _ := config.LoadDefaultConfig(ctx,
    config.WithEndpointResolverWithOptions(
        aws.EndpointResolverWithOptionsFunc(func(service, region string, options ...interface{}) (aws.Endpoint, error) {
            return aws.Endpoint{URL: "http://localhost:9000"}, nil
        }),
    ),
)
```

---

### Google Cloud Storage

```go
import "github.com/zoobzio/grub/gcs"
```

#### Constructor

```go
func New(client *storage.Client, bucket string) *Provider
```

```go
client, _ := storage.NewClient(ctx)
provider := gcs.New(client, "my-bucket")
```

#### Behaviors

| Operation | Implementation |
|-----------|---------------|
| Get | NewReader + ReadAll |
| Put | NewWriter |
| Delete | Delete |
| Exists | Attrs |
| List | Objects iterator |

#### Features

| Feature | Support |
|---------|---------|
| Metadata | Yes |
| ContentType | Yes (writer.ContentType) |
| ETag | Yes (Etag from attrs) |

#### Error Mapping

| GCS Error | Grub Error |
|-----------|------------|
| `storage.ErrObjectNotExist` | `ErrNotFound` |

---

### Azure Blob Storage

```go
import "github.com/zoobzio/grub/azure"
```

#### Constructor

```go
func New(client *azblob.Client, containerName string) *Provider
```

```go
cred, _ := azidentity.NewDefaultAzureCredential(nil)
client, _ := azblob.NewClient("https://account.blob.core.windows.net/", cred, nil)
provider := azure.New(client, "my-container")
```

#### Behaviors

| Operation | Implementation |
|-----------|---------------|
| Get | DownloadStream |
| Put | UploadBuffer |
| Delete | Delete |
| Exists | GetProperties |
| List | NewListBlobsFlatPager |

#### Features

| Feature | Support |
|---------|---------|
| Metadata | Yes (may need GetProperties) |
| ContentType | Yes |
| ETag | Yes (from properties) |

#### Error Mapping

| Azure Error | Grub Error |
|-------------|------------|
| `bloberror.BlobNotFound` | `ErrNotFound` |

#### Notes

- Metadata may require separate GetProperties call after download
- Azure uses `map[string]*string` for metadata (converted internally)

---

## SQL Driver Modules

Thin wrappers that register database drivers.

### PostgreSQL

```go
import _ "github.com/zoobzio/grub/postgres"
```

Registers `github.com/lib/pq` driver.

```go
import (
    _ "github.com/zoobzio/grub/postgres"
    "github.com/zoobzio/astql/pkg/postgres"
)

db, _ := sqlx.Connect("postgres", dsn)
users, _ := grub.NewDatabase[User](db, "users", "id", postgres.New())
```

### MariaDB

```go
import _ "github.com/zoobzio/grub/mariadb"
```

Registers `github.com/go-sql-driver/mysql` driver (MariaDB uses MySQL wire protocol).

```go
import (
    _ "github.com/zoobzio/grub/mariadb"
    "github.com/zoobzio/astql/pkg/mariadb"
)

db, _ := sqlx.Connect("mysql", dsn)
```

### SQLite

```go
import _ "github.com/zoobzio/grub/sqlite"
```

Registers `modernc.org/sqlite` driver (pure Go, no CGO).

```go
import (
    _ "github.com/zoobzio/grub/sqlite"
    "github.com/zoobzio/astql/pkg/sqlite"
)

db, _ := sqlx.Connect("sqlite", "./data.db")
```

#### In-Memory

```go
db, _ := sqlx.Connect("sqlite", ":memory:")
```

### SQL Server

```go
import _ "github.com/zoobzio/grub/mssql"
```

Registers `github.com/microsoft/go-mssqldb` driver.

```go
import (
    _ "github.com/zoobzio/grub/mssql"
    "github.com/zoobzio/astql/pkg/mssql"
)

db, _ := sqlx.Connect("sqlserver", dsn)
```

---

## Provider Comparison

### Key-Value Features

| Feature | Redis | Badger | Bolt |
|---------|-------|--------|------|
| TTL | ✓ | ✓ | ✗ |
| Batch atomicity | ✗ | ✓ | ✓ |
| Embedded | ✗ | ✓ | ✓ |
| Distributed | ✓ | ✗ | ✗ |
| Encryption | ✗ | ✓ | ✗ |
| In-memory mode | ✗ | ✓ | ✗ |

### Blob Features

| Feature | S3 | GCS | Azure |
|---------|-----|-----|-------|
| Metadata | ✓ | ✓ | ✓ |
| ContentType | ✓ | ✓ | ✓ |
| ETag | ✓ | ✓ | ✓ |
| Versioning | ✓ | ✓ | ✓ |

### Error Semantics

All providers map their native errors to grub semantic errors:

| Semantic Error | Meaning |
|----------------|---------|
| `ErrNotFound` | Key/object doesn't exist |
| `ErrTTLNotSupported` | Provider can't handle TTL |

### Context Cancellation

| Provider | Cancellation Support |
|----------|---------------------|
| Redis | All operations |
| Badger | Iteration |
| Bolt | Iteration |
| S3 | All operations |
| GCS | All operations |
| Azure | All operations |
