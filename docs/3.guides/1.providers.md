---
title: Providers
description: Choosing and configuring storage providers
author: zoobzio
published: 2025-01-07
updated: 2025-01-07
tags:
  - Providers
  - Configuration
  - Setup
---

# Providers

This guide covers provider selection, configuration, and provider-specific behaviors.

## Provider Overview

### Key-Value Stores

| Provider | Package | Best For |
|----------|---------|----------|
| Redis | `grub/redis` | Distributed cache, sessions, pub/sub |
| BadgerDB | `grub/badger` | Embedded, high-performance, SSD-optimized |
| BoltDB | `grub/bolt` | Embedded, simple, single-file |

### Blob Storage

| Provider | Package | Best For |
|----------|---------|----------|
| AWS S3 | `grub/s3` | Standard object storage, AWS ecosystem |
| Google Cloud Storage | `grub/gcs` | GCP ecosystem, global CDN |
| Azure Blob | `grub/azure` | Azure ecosystem, tiered storage |

### SQL Databases

| Driver | Package | Dialect |
|--------|---------|---------|
| PostgreSQL | `grub/postgres` | `astql/pkg/postgres` |
| MariaDB | `grub/mariadb` | `astql/pkg/mariadb` |
| SQLite | `grub/sqlite` | `astql/pkg/sqlite` |
| SQL Server | `grub/mssql` | `astql/pkg/mssql` |

## Key-Value Provider Setup

### Redis

```go
import (
    "github.com/zoobzio/grub"
    "github.com/zoobzio/grub/redis"
    goredis "github.com/redis/go-redis/v9"
)

func main() {
    client := goredis.NewClient(&goredis.Options{
        Addr:     "localhost:6379",
        Password: "",
        DB:       0,
    })
    defer client.Close()

    store := grub.NewStore[Session](redis.New(client))
}
```

**Features:**
- Full TTL support (native)
- List uses SCAN (cursor-based, safe for large datasets)
- GetBatch uses MGET
- SetBatch uses pipelined SET

**Cluster support:**

```go
client := goredis.NewClusterClient(&goredis.ClusterOptions{
    Addrs: []string{"node1:6379", "node2:6379", "node3:6379"},
})
store := grub.NewStore[Session](redis.New(client))
```

### BadgerDB

```go
import (
    "github.com/zoobzio/grub"
    "github.com/zoobzio/grub/badger"
    badgerdb "github.com/dgraph-io/badger/v4"
)

func main() {
    opts := badgerdb.DefaultOptions("./data")
    opts.Logger = nil // Silence logs

    db, err := badgerdb.Open(opts)
    if err != nil {
        log.Fatal(err)
    }
    defer db.Close()

    store := grub.NewStore[Config](badger.New(db))
}
```

**Features:**
- Full TTL support (native)
- Embedded (no external service)
- SSD-optimized LSM tree
- Supports encryption at rest

**In-memory mode:**

```go
opts := badgerdb.DefaultOptions("").WithInMemory(true)
db, _ := badgerdb.Open(opts)
```

### BoltDB

```go
import (
    "github.com/zoobzio/grub"
    "github.com/zoobzio/grub/bolt"
    "go.etcd.io/bbolt"
)

func main() {
    db, err := bbolt.Open("my.db", 0600, nil)
    if err != nil {
        log.Fatal(err)
    }
    defer db.Close()

    // Bucket name scopes the data
    store := grub.NewStore[Config](bolt.New(db, "configs"))
}
```

**Features:**
- Single-file database
- Bucket-scoped (multiple stores per DB)
- ACID transactions
- **No TTL support** (returns `ErrTTLNotSupported`)

**Multiple buckets:**

```go
configs := grub.NewStore[Config](bolt.New(db, "configs"))
sessions := grub.NewStore[Session](bolt.New(db, "sessions"))
```

## Blob Provider Setup

### AWS S3

```go
import (
    "github.com/zoobzio/grub"
    "github.com/zoobzio/grub/s3"
    "github.com/aws/aws-sdk-go-v2/config"
    awss3 "github.com/aws/aws-sdk-go-v2/service/s3"
)

func main() {
    cfg, err := config.LoadDefaultConfig(context.Background())
    if err != nil {
        log.Fatal(err)
    }

    client := awss3.NewFromConfig(cfg)
    bucket := grub.NewBucket[Document](s3.New(client, "my-bucket"))
}
```

**Notes:**
- Delete checks Exists first (S3 doesn't error on missing keys)
- List uses ListObjectsV2 with continuation tokens
- Metadata preserved in ObjectInfo

**Custom endpoint (MinIO, LocalStack):**

```go
cfg, _ := config.LoadDefaultConfig(ctx,
    config.WithEndpointResolverWithOptions(
        aws.EndpointResolverWithOptionsFunc(func(service, region string, options ...interface{}) (aws.Endpoint, error) {
            return aws.Endpoint{URL: "http://localhost:9000"}, nil
        }),
    ),
)
```

### Google Cloud Storage

```go
import (
    "github.com/zoobzio/grub"
    "github.com/zoobzio/grub/gcs"
    "cloud.google.com/go/storage"
)

func main() {
    client, err := storage.NewClient(context.Background())
    if err != nil {
        log.Fatal(err)
    }
    defer client.Close()

    bucket := grub.NewBucket[Document](gcs.New(client, "my-bucket"))
}
```

**Notes:**
- ContentType set via writer.ContentType
- Metadata preserved
- Uses storage.Iterator for List

### Azure Blob Storage

```go
import (
    "github.com/zoobzio/grub"
    "github.com/zoobzio/grub/azure"
    "github.com/Azure/azure-sdk-for-go/sdk/storage/azblob"
)

func main() {
    cred, err := azidentity.NewDefaultAzureCredential(nil)
    if err != nil {
        log.Fatal(err)
    }

    client, err := azblob.NewClient(
        "https://myaccount.blob.core.windows.net/",
        cred,
        nil,
    )
    if err != nil {
        log.Fatal(err)
    }

    bucket := grub.NewBucket[Document](azure.New(client, "my-container"))
}
```

**Notes:**
- Metadata may require separate GetProperties call
- Uses NewListBlobsFlatPager for List

## SQL Database Setup

### PostgreSQL

```go
import (
    "github.com/zoobzio/grub"
    _ "github.com/zoobzio/grub/postgres" // Register driver
    "github.com/zoobzio/astql/pkg/postgres"
    "github.com/jmoiron/sqlx"
)

func main() {
    db, err := sqlx.Connect("postgres", "postgres://user:pass@localhost/db?sslmode=disable")
    if err != nil {
        log.Fatal(err)
    }
    defer db.Close()

    users, err := grub.NewDatabase[User](db, "users", "id", postgres.New())
}
```

### MariaDB

```go
import (
    _ "github.com/zoobzio/grub/mariadb"
    "github.com/zoobzio/astql/pkg/mariadb"
)

db, _ := sqlx.Connect("mysql", "user:pass@tcp(localhost:3306)/db")
users, _ := grub.NewDatabase[User](db, "users", "id", mariadb.New())
```

### SQLite

```go
import (
    _ "github.com/zoobzio/grub/sqlite"
    "github.com/zoobzio/astql/pkg/sqlite"
)

db, _ := sqlx.Connect("sqlite", "./data.db")
users, _ := grub.NewDatabase[User](db, "users", "id", sqlite.New())
```

### SQL Server

```go
import (
    _ "github.com/zoobzio/grub/mssql"
    "github.com/zoobzio/astql/pkg/mssql"
)

db, _ := sqlx.Connect("sqlserver", "sqlserver://user:pass@localhost?database=db")
users, _ := grub.NewDatabase[User](db, "users", "id", mssql.New())
```

## Provider Selection Guide

### When to Use Each Provider

| Scenario | Recommended Provider |
|----------|---------------------|
| Distributed sessions | Redis |
| Local cache | BadgerDB |
| Simple config storage | BoltDB |
| File uploads | S3/GCS/Azure |
| Structured queries | PostgreSQL/MariaDB |
| Embedded SQL | SQLite |
| Development/testing | BadgerDB (in-memory) or SQLite |

### Feature Comparison (Key-Value)

| Feature | Redis | Badger | Bolt |
|---------|-------|--------|------|
| TTL | ✓ | ✓ | ✗ |
| Distributed | ✓ | ✗ | ✗ |
| Embedded | ✗ | ✓ | ✓ |
| Encryption | ✗ | ✓ | ✗ |
| Transactions | ✓ | ✓ | ✓ |

### Feature Comparison (Blob)

| Feature | S3 | GCS | Azure |
|---------|-----|-----|-------|
| Versioning | ✓ | ✓ | ✓ |
| Lifecycle | ✓ | ✓ | ✓ |
| CDN | CloudFront | Cloud CDN | Azure CDN |
| Presigned URLs | ✓ | ✓ | SAS tokens |

## Switching Providers

One of grub's benefits is easy provider switching:

```go
// Development
store := grub.NewStore[Session](badger.New(devDB))

// Production
store := grub.NewStore[Session](redis.New(prodClient))
```

Business logic remains unchanged. Only the provider initialization differs.

**Caveats:**
- TTL behavior differs (BoltDB doesn't support it)
- Batch atomicity varies by provider
- Some providers have unique features not exposed through grub
